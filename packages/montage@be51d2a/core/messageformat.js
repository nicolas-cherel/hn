(function(t){function e(t,n){var i;if(t&&n&&(e.locale[t]=n),i=t=t||"en",n=n||e.locale[i=e.Utils.getFallbackLocale(t)],!n)throw Error("Plural Function not found for locale: "+t);this.pluralFunc=n,this.locale=t,this.fallbackLocale=i}e.locale={en:function(t){return 1===t?"one":"other"}},e.SafeString=function(t){this.string=t},e.SafeString.prototype.toString=function(){return""+this.string},e.Utils={numSub:function(t,e,n){return t.replace(/^#|[^\\]#/g,function(t){var i=t&&2===t.length?t.charAt(0):"";return i+'" + (function(){ var x = '+e+';\nif( isNaN(x) ){\nthrow new Error("MessageFormat: `"+lastkey_'+n+'+"` isnt a number.");\n}\nreturn x;\n})() + "'})},escapeExpression:function(t){var n={"\n":"\\n",'"':'\\"'},i=/[\n"]/g,r=/[\n"]/,a=function(t){return n[t]||"&amp;"};return t instanceof e.SafeString?""+t:null===t||t===!1?"":r.test(t)?t.replace(i,a):t},getFallbackLocale:function(t){for(var n=t.indexOf("-")>=0?"-":"_";!e.locale.hasOwnProperty(t);)if(t=t.substring(0,t.lastIndexOf(n)),0===t.length)return null;return t}};var n=function(){var t={parse:function(t,e){function n(t,e,n){for(var i=t,r=n-t.length,a=0;r>a;a++)i=e+i;return i}function i(t){var e=t.charCodeAt(0);if(255>=e)var i="x",r=2;else var i="u",r=4;return"\\"+i+n(e.toString(16).toUpperCase(),"0",r)}function r(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,i)+'"'}function a(t){P>S||(S>P&&(P=S,A=[]),A.push(t))}function o(){var t="start@"+S,e=B[t];if(e)return S=e.nextPos,e.result;var n=S,i=s(),r=null!==i?function(t){return{type:"program",program:t}}(i):null;if(null!==r)var a=r;else{var a=null;S=n}return B[t]={nextPos:S,result:a},a}function s(){var t="messageFormatPattern@"+S,e=B[t];if(e)return S=e.nextPos,e.result;var n=S,i=S,r=b();if(null!==r){for(var a=[],o=l();null!==o;){a.push(o);var o=l()}if(null!==a)var s=[r,a];else{var s=null;S=i}}else{var s=null;S=i}var c=null!==s?function(t,e){var n=[];t&&t.val&&n.push(t);for(var i in e)e.hasOwnProperty(i)&&n.push(e[i]);return{type:"messageFormatPattern",statements:n}}(s[0],s[1]):null;if(null!==c)var u=c;else{var u=null;S=n}return B[t]={nextPos:S,result:u},u}function l(){var e="messageFormatPatternRight@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S,r=S;if("{"===t.substr(S,1)){var o="{";S+=1}else{var o=null;k&&a('"{"')}if(null!==o){var s=x();if(null!==s){var l=c();if(null!==l){var u=x();if(null!==u){if("}"===t.substr(S,1)){var h="}";S+=1}else{var h=null;k&&a('"}"')}if(null!==h){var d=b();if(null!==d)var p=[o,s,l,u,h,d];else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}var f=null!==p?function(t,e){var n=[];return t&&n.push(t),e&&e.val&&n.push(e),{type:"messageFormatPatternRight",statements:n}}(p[2],p[5]):null;if(null!==f)var g=f;else{var g=null;S=i}return B[e]={nextPos:S,result:g},g}function c(){var e="messageFormatElement@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S,r=S,o=y();if(null!==o){var s=S;if(","===t.substr(S,1)){var l=",";S+=1}else{var l=null;k&&a('","')}if(null!==l){var c=u();if(null!==c)var h=[l,c];else{var h=null;S=s}}else{var h=null;S=s}var d=null!==h?h:"";if(null!==d)var p=[o,d];else{var p=null;S=r}}else{var p=null;S=r}var f=null!==p?function(t,e){var n={type:"messageFormatElement",argumentIndex:t};return e&&e.length?n.elementFormat=e[1]:n.output=!0,n}(p[0],p[1]):null;if(null!==f)var g=f;else{var g=null;S=i}return B[e]={nextPos:S,result:g},g}function u(){var e="elementFormat@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S,r=S,o=x();if(null!==o){if("plural"===t.substr(S,6)){var s="plural";S+=6}else{var s=null;k&&a('"plural"')}if(null!==s){var l=x();if(null!==l){if(","===t.substr(S,1)){var c=",";S+=1}else{var c=null;k&&a('","')}if(null!==c){var u=x();if(null!==u){var p=h();if(null!==p){var f=x();if(null!==f)var g=[o,s,l,c,u,p,f];else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}var v=null!==g?function(t,e){return{type:"elementFormat",key:t,val:e.val}}(g[1],g[5]):null;if(null!==v)var m=v;else{var m=null;S=i}if(null!==m)var b=m;else{var y=S,w=S,L=x();if(null!==L){if("select"===t.substr(S,6)){var C="select";S+=6}else{var C=null;k&&a('"select"')}if(null!==C){var M=x();if(null!==M){if(","===t.substr(S,1)){var _=",";S+=1}else{var _=null;k&&a('","')}if(null!==_){var z=x();if(null!==z){var E=d();if(null!==E){var T=x();if(null!==T)var P=[L,C,M,_,z,E,T];else{var P=null;S=w}}else{var P=null;S=w}}else{var P=null;S=w}}else{var P=null;S=w}}else{var P=null;S=w}}else{var P=null;S=w}}else{var P=null;S=w}var A=null!==P?function(t,e){return{type:"elementFormat",key:t,val:e.val}}(P[1],P[5]):null;if(null!==A)var O=A;else{var O=null;S=y}if(null!==O)var b=O;else var b=null}return B[e]={nextPos:S,result:b},b}function h(){var t="pluralStyle@"+S,e=B[t];if(e)return S=e.nextPos,e.result;var n=S,i=p(),r=null!==i?function(t){return{type:"pluralStyle",val:t}}(i):null;if(null!==r)var a=r;else{var a=null;S=n}return B[t]={nextPos:S,result:a},a}function d(){var t="selectStyle@"+S,e=B[t];if(e)return S=e.nextPos,e.result;var n=S,i=g(),r=null!==i?function(t){return{type:"selectStyle",val:t}}(i):null;if(null!==r)var a=r;else{var a=null;S=n}return B[t]={nextPos:S,result:a},a}function p(){var t="pluralFormatPattern@"+S,e=B[t];if(e)return S=e.nextPos,e.result;var n=S,i=S,r=f(),a=null!==r?r:"";if(null!==a){for(var o=[],s=v();null!==s;){o.push(s);var s=v()}if(null!==o)var l=[a,o];else{var l=null;S=i}}else{var l=null;S=i}var c=null!==l?function(t,e){var n={type:"pluralFormatPattern",pluralForms:e};return n.offset=t?t:0,n}(l[0],l[1]):null;if(null!==c)var u=c;else{var u=null;S=n}return B[t]={nextPos:S,result:u},u}function f(){var e="offsetPattern@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S,r=S,o=x();if(null!==o){if("offset"===t.substr(S,6)){var s="offset";S+=6}else{var s=null;k&&a('"offset"')}if(null!==s){var l=x();if(null!==l){if(":"===t.substr(S,1)){var c=":";S+=1}else{var c=null;k&&a('":"')}if(null!==c){var u=x();if(null!==u){var h=C();if(null!==h){var d=x();if(null!==d)var p=[o,s,l,c,u,h,d];else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}}else{var p=null;S=r}var f=null!==p?function(t){return t}(p[5]):null;if(null!==f)var g=f;else{var g=null;S=i}return B[e]={nextPos:S,result:g},g}function g(){var t="selectFormatPattern@"+S,e=B[t];if(e)return S=e.nextPos,e.result;for(var n=S,i=[],r=v();null!==r;){i.push(r);var r=v()}var a=null!==i?function(t){return{type:"selectFormatPattern",pluralForms:t}}(i):null;if(null!==a)var o=a;else{var o=null;S=n}return B[t]={nextPos:S,result:o},o}function v(){var e="pluralForms@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S,r=S,o=x();if(null!==o){var l=m();if(null!==l){var c=x();if(null!==c){if("{"===t.substr(S,1)){var u="{";S+=1}else{var u=null;k&&a('"{"')}if(null!==u){var h=x();if(null!==h){var d=s();if(null!==d){var p=x();if(null!==p){if("}"===t.substr(S,1)){var f="}";S+=1}else{var f=null;k&&a('"}"')}if(null!==f)var g=[o,l,c,u,h,d,p,f];else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}}else{var g=null;S=r}var v=null!==g?function(t,e){return{type:"pluralForms",key:t,val:e}}(g[1],g[5]):null;if(null!==v)var b=v;else{var b=null;S=i}return B[e]={nextPos:S,result:b},b}function m(){var e="stringKey@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S,r=y(),o=null!==r?function(t){return t}(r):null;if(null!==o)var s=o;else{var s=null;S=i}if(null!==s)var l=s;else{var c=S,u=S;if("="===t.substr(S,1)){var h="=";S+=1}else{var h=null;k&&a('"="')}if(null!==h){var d=C();if(null!==d)var p=[h,d];else{var p=null;S=u}}else{var p=null;S=u}var f=null!==p?function(t){return t}(p[1]):null;if(null!==f)var g=f;else{var g=null;S=c}if(null!==g)var l=g;else var l=null}return B[e]={nextPos:S,result:l},l}function b(){var t="string@"+S,e=B[t];if(e)return S=e.nextPos,e.result;var n=S,i=S,r=x();if(null!==r){var a=[],o=S,s=x();if(null!==s){var l=w();if(null!==l){var c=x();if(null!==c)var u=[s,l,c];else{var u=null;S=o}}else{var u=null;S=o}}else{var u=null;S=o}for(;null!==u;){a.push(u);var o=S,s=x();if(null!==s){var l=w();if(null!==l){var c=x();if(null!==c)var u=[s,l,c];else{var u=null;S=o}}else{var u=null;S=o}}else{var u=null;S=o}}if(null!==a)var h=[r,a];else{var h=null;S=i}}else{var h=null;S=i}var d=null!==h?function(t,e){for(var n=[],i=0;e.length>i;++i)for(var r=0;e[i].length>r;++r)n.push(e[i][r]);return{type:"string",val:t+n.join("")}}(h[0],h[1]):null;if(null!==d)var p=d;else{var p=null;S=n}return B[t]={nextPos:S,result:p},p}function y(){var e="id@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S,r=S,o=x();if(null!==o){if(null!==t.substr(S).match(/^[a-zA-Z$_]/)){var s=t.charAt(S);S++}else{var s=null;k&&a("[a-zA-Z$_]")}if(null!==s){var l=[];if(null!==t.substr(S).match(/^[^ 	\n\r,.+={}]/)){var c=t.charAt(S);S++}else{var c=null;k&&a("[^ 	\\n\\r,.+={}]")}for(;null!==c;)if(l.push(c),null!==t.substr(S).match(/^[^ 	\n\r,.+={}]/)){var c=t.charAt(S);S++}else{var c=null;k&&a("[^ 	\\n\\r,.+={}]")}if(null!==l){var u=x();if(null!==u)var h=[o,s,l,u];else{var h=null;S=r}}else{var h=null;S=r}}else{var h=null;S=r}}else{var h=null;S=r}var d=null!==h?function(t,e){return t+(e?e.join(""):"")}(h[1],h[2]):null;if(null!==d)var p=d;else{var p=null;S=i}return B[e]={nextPos:S,result:p},p}function w(){var t="chars@"+S,e=B[t];if(e)return S=e.nextPos,e.result;var n=S,i=L();if(null!==i)for(var r=[];null!==i;){r.push(i);var i=L()}else var r=null;var a=null!==r?function(t){return t.join("")}(r):null;if(null!==a)var o=a;else{var o=null;S=n}return B[t]={nextPos:S,result:o},o}function L(){var e="char@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S;if(null!==t.substr(S).match(/^[^{}\\\0- 	\n\r]/)){var r=t.charAt(S);S++}else{var r=null;k&&a("[^{}\\\\\\0- 	\\n\\r]")}var o=null!==r?function(t){return t}(r):null;if(null!==o)var s=o;else{var s=null;S=i}if(null!==s)var l=s;else{var c=S;if("\\#"===t.substr(S,2)){var u="\\#";S+=2}else{var u=null;k&&a('"\\\\#"')}var h=null!==u?function(){return"\\#"}():null;if(null!==h)var d=h;else{var d=null;S=c}if(null!==d)var l=d;else{var p=S;if("\\{"===t.substr(S,2)){var f="\\{";S+=2}else{var f=null;k&&a('"\\\\{"')}var g=null!==f?function(){return"{"}():null;if(null!==g)var v=g;else{var v=null;S=p}if(null!==v)var l=v;else{var m=S;if("\\}"===t.substr(S,2)){var b="\\}";S+=2}else{var b=null;k&&a('"\\\\}"')}var y=null!==b?function(){return"}"}():null;if(null!==y)var w=y;else{var w=null;S=m}if(null!==w)var l=w;else{var L=S,C=S;if("\\u"===t.substr(S,2)){var x="\\u";S+=2}else{var x=null;k&&a('"\\\\u"')}if(null!==x){var _=M();if(null!==_){var z=M();if(null!==z){var E=M();if(null!==E){var T=M();if(null!==T)var P=[x,_,z,E,T];else{var P=null;S=C}}else{var P=null;S=C}}else{var P=null;S=C}}else{var P=null;S=C}}else{var P=null;S=C}var A=null!==P?function(t,e,n,i){return String.fromCharCode(parseInt("0x"+t+e+n+i))}(P[1],P[2],P[3],P[4]):null;if(null!==A)var O=A;else{var O=null;S=L}if(null!==O)var l=O;else var l=null}}}}return B[e]={nextPos:S,result:l},l}function C(){var e="digits@"+S,n=B[e];if(n)return S=n.nextPos,n.result;var i=S;if(null!==t.substr(S).match(/^[0-9]/)){var r=t.charAt(S);S++}else{var r=null;k&&a("[0-9]")}if(null!==r)for(var o=[];null!==r;)if(o.push(r),null!==t.substr(S).match(/^[0-9]/)){var r=t.charAt(S);S++}else{var r=null;k&&a("[0-9]")}else var o=null;var s=null!==o?function(t){return parseInt(t.join(""),10)}(o):null;if(null!==s)var l=s;else{var l=null;S=i}return B[e]={nextPos:S,result:l},l}function M(){var e="hexDigit@"+S,n=B[e];if(n)return S=n.nextPos,n.result;if(null!==t.substr(S).match(/^[0-9a-fA-F]/)){var i=t.charAt(S);S++}else{var i=null;k&&a("[0-9a-fA-F]")}return B[e]={nextPos:S,result:i},i}function x(){var t="_@"+S,e=B[t];if(e)return S=e.nextPos,e.result;var n=k;k=!1;for(var i=S,r=[],o=_();null!==o;){r.push(o);var o=_()}var s=null!==r?function(t){return t.join("")}(r):null;if(null!==s)var l=s;else{var l=null;S=i}return k=n,k&&null===l&&a("whitespace"),B[t]={nextPos:S,result:l},l}function _(){var e="whitespace@"+S,n=B[e];if(n)return S=n.nextPos,n.result;if(null!==t.substr(S).match(/^[ 	\n\r]/)){var i=t.charAt(S);S++}else{var i=null;k&&a("[ 	\\n\\r]")}return B[e]={nextPos:S,result:i},i}function z(){function e(t){t.sort();for(var e=null,n=[],i=0;t.length>i;i++)t[i]!==e&&(n.push(t[i]),e=t[i]);switch(n.length){case 0:return"end of input";case 1:return n[0];default:return n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}}var n=e(A),i=Math.max(S,P),a=t.length>i?r(t.charAt(i)):"end of input";return"Expected "+n+" but "+a+" found."}function E(){for(var e=1,n=1,i=!1,r=0;P>r;r++){var a=t.charAt(r);"\n"===a?(i||e++,n=1,i=!1):"\r"===a|"\u2028"===a||"\u2029"===a?(e++,n=1,i=!0):(n++,i=!1)}return{line:e,column:n}}var T={_:x,"char":L,chars:w,digits:C,elementFormat:u,hexDigit:M,id:y,messageFormatElement:c,messageFormatPattern:s,messageFormatPatternRight:l,offsetPattern:f,pluralFormatPattern:p,pluralForms:v,pluralStyle:h,selectFormatPattern:g,selectStyle:d,start:o,string:b,stringKey:m,whitespace:_};if(void 0!==e){if(void 0===T[e])throw Error("Invalid rule name: "+r(e)+".")}else e="start";var S=0,k=!0,P=0,A=[],B={},O=T[e]();if(null===O||S!==t.length){var D=E();throw new this.SyntaxError(z(),D.line,D.column)}return O},toSource:function(){return this._source}};return t.SyntaxError=function(t,e,n){this.name="SyntaxError",this.message=t,this.line=e,this.column=n},t.SyntaxError.prototype=Error.prototype,t}();e.prototype.parse=function(){return n.parse.apply(n,arguments)},e.prototype.precompile=function(t){function n(t,o){o=o||{};var s,l,c,u="";switch(t.type){case"program":return n(t.program);case"messageFormatPattern":for(s=0;t.statements.length>s;++s)u+=n(t.statements[s],o);return a.begin+u+a.end;case"messageFormatPatternRight":for(s=0;t.statements.length>s;++s)u+=n(t.statements[s],o);return u;case"messageFormatElement":return o.pf_count=o.pf_count||0,u+='if(!d){\nthrow new Error("MessageFormat: No data passed to function.");\n}\n',t.output?u+='r += d["'+t.argumentIndex+'"];\n':(c="lastkey_"+(o.pf_count+1),u+="var "+c+' = "'+t.argumentIndex+'";\n',u+="var k_"+(o.pf_count+1)+"=d["+c+"];\n",u+=n(t.elementFormat,o)),u;case"elementFormat":return"select"===t.key?(u+=n(t.val,o),u+="r += (pf_"+o.pf_count+"[ k_"+(o.pf_count+1)+" ] || pf_"+o.pf_count+'[ "other" ])( d );\n'):"plural"===t.key&&(u+=n(t.val,o),u+="if ( pf_"+o.pf_count+"[ k_"+(o.pf_count+1)+' + "" ] ) {\n',u+="r += pf_"+o.pf_count+"[ k_"+(o.pf_count+1)+' + "" ]( d ); \n',u+="}\nelse {\n",u+="r += (pf_"+o.pf_count+'[ MessageFormat.locale["'+i.fallbackLocale+'"]( k_'+(o.pf_count+1)+" - off_"+o.pf_count+" ) ] || pf_"+o.pf_count+'[ "other" ] )( d );\n',u+="}\n"),u;case"pluralFormatPattern":for(o.pf_count=o.pf_count||0,u+="var off_"+o.pf_count+" = "+t.offset+";\n",u+="var pf_"+o.pf_count+" = { \n",r=!0,s=0;t.pluralForms.length>s;++s)"other"===t.pluralForms[s].key&&(r=!1),l?u+=",\n":l=1,u+='"'+t.pluralForms[s].key+'" : '+n(t.pluralForms[s].val,function(){var t=JSON.parse(JSON.stringify(o));return t.pf_count++,t}());if(u+="\n};\n",r)throw Error("No 'other' form found in pluralFormatPattern "+o.pf_count);return u;case"selectFormatPattern":for(o.pf_count=o.pf_count||0,u+="var off_"+o.pf_count+" = 0;\n",u+="var pf_"+o.pf_count+" = { \n",r=!0,s=0;t.pluralForms.length>s;++s)"other"===t.pluralForms[s].key&&(r=!1),l?u+=",\n":l=1,u+='"'+t.pluralForms[s].key+'" : '+n(t.pluralForms[s].val,function(){var t=JSON.parse(JSON.stringify(o));return t.pf_count++,t}());if(u+="\n};\n",r)throw Error("No 'other' form found in selectFormatPattern "+o.pf_count);return u;case"string":return'r += "'+e.Utils.numSub(e.Utils.escapeExpression(t.val),"k_"+o.pf_count+" - off_"+(o.pf_count-1),o.pf_count)+'";\n';default:throw Error("Bad AST type: "+t.type)}}var i=this,r=!1,a={begin:'function(d){\nvar r = "";\n',end:"return r;\n}"};return n(t)},e.prototype.compile=function(t){return Function("MessageFormat","return "+this.precompile(this.parse(t)))(e)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.MessageFormat=e):"function"==typeof define&&define.amd?define(function(){return e}):t.MessageFormat=e})(this);