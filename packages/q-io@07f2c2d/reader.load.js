montageDefine("07f2c2d","reader",{dependencies:["q"],factory:function(e,t,n){function i(e,t){function n(){var e;return e=t?c.join(""):r.constructor.join(c),c.splice(0,c.length),e}var r=Object.create(i.prototype);t&&e.setEncoding&&e.setEncoding(t);var a=o.defer(),s=o.defer();e.on("error",function(e){a.reject(e)});var l,c=[];return e.on("end",function(){a.resolve(r),s.resolve()}),e.on("data",function(e){a.resolve(r),l?l(e):c.push(e)}),r.read=function(){l=void 0;var e=o.defer();return o.done(s.promise,function(){e.resolve(n())}),e.promise},r.forEach=function(e){return c&&c.length&&e(n()),l=e,o.when(s.promise,function(){l=void 0})},r.close=function(){e.destroy()},r.node=e,a.promise}function r(e,t){var n=[];return e.forEach(function(e){n.push(e)}),t?n.join(""):a(n)}function a(e){var t,n,i,r,a=0,o=e.length;for(n=0;o>n;n++)i=e[n],a+=i.length;for(r=new Buffer(a),t=0,n=0;o>n;n++)i=e[n],i.copy(r,t,0),t+=i.length;return e.splice(0,o,r),r}var o=e("q");n.exports=i,i.read=r,i.join=a}});